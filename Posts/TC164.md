{"Tags":["TopCoder", "AI", "Simulation", "Post-Mortem"], "Id":"topcoder", "Title": "Top Coder 163", "Description": "Post mortem of the Bridge builder challenge on top coder", "Created": "2025-09-17", "Category": "TopCoder" }
# TC164

Seems I might be winning this one, which is fun! Thanks for making and hosting it. Good game :)

## PM 
```
maxSearchDepth = segments.size() + 4 + 60 / B;
```

Segments are map divided in regions where you can move with 50 bridges. 
The closest node between each segments that are <= 100 bridges long are used as connectors (if you have to wait you go there)

I use 2 sets of Dijkstra distances <= 50 is 1 step in both. In D1 I only allow the connectors to be used and they count as 3 steps. (On seeds with only 1 segment I set this distance to 6 steps and allow all such <= 100 transitions)
In D2 I allow all transitions, but longer bridges count as 2 steps for many segments and 3 steps for 1 segment maps.

D1 is used in scoring: 
```
  float getScore() {
    float s = score * 15;

    F0 (i, B) {
      if (stateMen[i].target >= 0) {
        s -= getDist1(stateMen[i].target, stateMen[i].pos);
      }
    }

    return s;
  }
```

Then for ~9 ms every turn I search `maxSearchDepth` with guided heuristics and a bunch of small random parts. For smaller maps I allow the first move to be 10 % fully random.
```
      F0 (i, maxSearchDepth) {
        s.allowRandom = i == 0 && lastEvals > 300;

        s.doTurn();
        score += s.getScore();
        score *= 1.3;
      }
```
The 30 % addon on each scoring makes the later depths almost useless, but the longer depths stops me from getting stuck since my code has no logic in terms of cooperation.

doTurn is a set of randomized functions where building has a chance of returning for others to move before the next build is done. The chance on moveCloser is to allow moving to same length targets.
The Bridge men always have to pack the bridge they built. Nothing is left behind and everyone keeps their initial 50.
```
  void doTurn() {
    usedMen.reset();
    moveCloser(false);
    doRandomWait();
    while (doDualBuild()) {
      moveCloser(rnd.nextfloat() < 0.1);
    }
    doRandomWait();
    while (doBuild()) {
      moveCloser(rnd.nextfloat() < 0.5);
    }

    packDoubleBridges();
    packBridges();
    afterTurn();
  }
```

All actions have the highest chance of doing one of the optimal choices. And every iteration of B or O are done using random sets of orders to test different orders of actions.

D2 is used with 20 % proba in all the actions to sometimes guide men towards other dual bridge targets. 

After every turn I reassign the messages not picked up yet among all men without a message.

Waiting in done in 5% of the cases and only for units that has a built bridge and moved across it.

Scores:

```
Seed = 1, Score = 95.0
Seed = 2, Score = 1479.0
Seed = 3, Score = 372.0
Seed = 4, Score = 464.0
Seed = 5, Score = 1724.0
Seed = 6, Score = 1526.0
Seed = 7, Score = 1197.0
Seed = 8, Score = 824.0
Seed = 9, Score = 1261.0
Seed = 10, Score = 226.0
```
